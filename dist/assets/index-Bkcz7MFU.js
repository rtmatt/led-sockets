(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const e of s)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const e={};return s.integrity&&(e.integrity=s.integrity),s.referrerPolicy&&(e.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?e.credentials="include":s.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function a(s){if(s.ep)return;s.ep=!0;const e=o(s);fetch(s.href,e)}})();const i={VITE_PRODUCTION_WEB_SOCKET_URL:"wss://led-sockets.mattemrick.com/ws/"},{VITE_PRODUCTION_WEB_SOCKET_URL:c}=i;class d{button;checkbox;messageContainer;state={socket:"disconnected",status:!1,hardware:!1};statusContainer;hardwareStatusContainer;websocket;constructor(){this.websocket=new WebSocket(c),this.button=document.getElementById("button"),this.checkbox=document.getElementById("checkbox"),this.messageContainer=document.getElementById("message-container"),this.statusContainer=document.getElementById("status"),this.hardwareStatusContainer=document.getElementById("hStatus"),this._addSocketListeners(),this._addUiListeners()}_addSocketListeners(){this.websocket.addEventListener("close",this.onSocketClose.bind(this)),this.websocket.addEventListener("error",this.onSocketError.bind(this)),this.websocket.addEventListener("message",this.onSocketMessage.bind(this)),this.websocket.addEventListener("open",this.onSocketOpen.bind(this))}_addUiListeners(){this.button.addEventListener("click",()=>{const o={type:"patch_hardware_state",attributes:{on:!this.state.status}};this.websocket.send(JSON.stringify(o))})}onSocketClose(t){console.error("Socket Closed"+t.reason),this.updateHardwareStatus(!1),this.updateSocketStatus("Closed")}onSocketError(t){console.error("Socket Error",t),this.updateHardwareStatus(!1),this.updateSocketStatus("Error")}onSocketMessage(t){const{data:o}=t;let a;try{a=JSON.parse(o)}catch{console.warn(o)}if(a&&typeof a=="object"&&"type"in a&&a.type){let s=a,e;switch(s.type){case"hardware_state":e=a,this.updateState(e.attributes);break;case"hardware_connection":e=a,this.updateState(e.relationships.hardware_state.data.attributes),this.updateHardwareStatus(e.attributes.is_connected);break;case"client_init":e=a,this.updateState(e.relationships.hardware_state.data.attributes),this.updateHardwareStatus(e.attributes.hardware_is_connected);break}}}onSocketOpen(){this.updateSocketStatus("Open"),this.websocket.send(JSON.stringify({id:"",type:"init_client"}))}updateSocketStatus(t){this.state.socket=t,this.statusContainer.innerText=t}updateHardwareStatus(t){this.state.hardware=t,this.hardwareStatusContainer.innerText=t?"Connected":"Disconnected"}updateState(t){const{on:o,message:a}=t||{on:!1,message:""};this.state.status=o,this.checkbox.checked=o,this.messageContainer.innerText=a}}document.addEventListener("DOMContentLoaded",()=>{new d});
