(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function s(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(t){if(t.ep)return;t.ep=!0;const i=s(t);fetch(t.href,i)}})();function c(n){return!!n&&typeof n=="object"&&"type"in n&&!!n.type}function a(n){if(n.type!=="hardware_state")return!1;const{attributes:e}=n;return e?"on"in e&&typeof e.on=="boolean"&&"message"in e&&typeof e.message=="string":!0}function d(n){if(n.type!=="client_init")return!1;const{attributes:e,relationships:s}=n;if(!e||!s)return!0;if(!("hardware_is_connected"in e&&typeof e.hardware_is_connected=="boolean"))return!1;const{hardware_state:o}=s;if(!o)return!1;const{data:t}=o;return a(t)}function h(n){if(n.type!=="hardware_connection")return!1;const{attributes:e,relationships:s}=n;if(!e||!s)return!0;if(!("is_connected"in e&&typeof e.is_connected=="boolean"))return!1;const{hardware_state:o}=s;if(!o)return!1;const{data:t}=o;return a(t)}const l={VITE_PRODUCTION_WEB_SOCKET_URL:"wss://led-sockets.mattemrick.com/ws/"},{VITE_PRODUCTION_WEB_SOCKET_URL:u}=l;class f{elements;state={socket:"Closed",status:!1,hardware:!1,message:"",checkbox:!1};websocket;abort_controller;is_connecting=!1;constructor(){this.elements={button:document.getElementById("button"),checkbox:document.getElementById("checkbox"),messageContainer:document.getElementById("message-container"),socketStatusContainer:document.getElementById("status"),hardwareStatusContainer:document.getElementById("hStatus"),reconnect:document.getElementById("rbutton")},this.socket_status="Attempting to connect",this.hardware_state=!1,this.message="",this.status=!1,this.checkbox_status=!1,this._addUiListeners();const{websocket:e,abort_controller:s}=this.buildConnection();this.websocket=e,this.abort_controller=s,window.addEventListener("pagehide",()=>{this.websocket&&this.websocket.close(),this.websocket=null}),window.addEventListener("pageshow",o=>{if(o.persisted){if(this.websocket_is_connected||this.is_connecting)return;this.reconnect()}})}get websocket_is_connected(){return!!this.websocket&&this.websocket.readyState===WebSocket.OPEN}log(...e){}buildConnection(){this.log("Connecting"),this.is_connecting=!0,this.websocket&&(this.websocket.readyState!==this.websocket.CLOSED&&console.warn("Build connection called with open socket"),this.abort_controller&&(this.log("Removing existing socket listeners"),this.abort_controller.abort()),this.websocket.close());const e=new WebSocket(u),s=new AbortController;return this._addSocketListeners(e,s),{websocket:e,abort_controller:s}}reconnect(){this.log("Reconnecting"),this.elements.reconnect.hidden=!0;const{websocket:e,abort_controller:s}=this.buildConnection();this.websocket=e,this.abort_controller=s}get checkbox_status(){return this.state.checkbox}set checkbox_status(e){this.state.checkbox=e,this.elements.checkbox.checked=e}get hardware_state(){return this.state.hardware}set hardware_state(e){this.state.hardware=e,this.elements.hardwareStatusContainer.innerText=e?"Connected":"Disconnected",this.elements.button.disabled=!e}get message(){return this.state.socket}set message(e){this.state.message=e,this.elements.messageContainer.innerText=e}get socket_status(){return this.state.socket}set socket_status(e){this.state.socket=e,this.elements.socketStatusContainer.innerText=e}get status(){return this.state.status}set status(e){this.state.status=e}_addSocketListeners(e,s){e.addEventListener("close",this.onSocketClose.bind(this,e),{signal:s.signal}),e.addEventListener("error",this.onSocketError.bind(this,e),{signal:s.signal}),e.addEventListener("message",this.onSocketMessage.bind(this,e),{signal:s.signal}),e.addEventListener("open",this.onSocketOpen.bind(this,e),{signal:s.signal})}_addUiListeners(){this.elements.button.addEventListener("click",()=>{if(this.websocket){const e={type:"patch_hardware_state",attributes:{on:!this.state.status}};this.websocket.send(JSON.stringify(e))}else throw Error("No active connection")}),this.elements.reconnect.addEventListener("click",()=>{this.reconnect()})}onSocketClose(e,s){this.is_connecting=!1,this.log(`Socket closed: ${s.reason}`),this.hardware_state=!1,this.socket_status="Closed",this.elements.reconnect.hidden=!1,this.abort_controller.abort()}onSocketError(e,s){this.log("Socket Error",s)}onSocketMessage(e,s){const{data:o}=s;let t;try{t=JSON.parse(o)}catch{console.warn(o)}c(t)&&(a(t)?this.updateState(t.attributes):h(t)?(this.updateState(t.relationships.hardware_state.data.attributes),this.hardware_state=t.attributes.is_connected):d(t)&&(this.updateState(t.relationships.hardware_state.data.attributes),this.hardware_state=t.attributes.hardware_is_connected))}onSocketOpen(e,s){this.log("Connected"),this.is_connecting=!1,this.socket_status="Open",e.send(JSON.stringify({id:"",type:"init_client"}))}updateState(e){const{on:s,message:o}=e||{on:!1,message:""};this.status=s,this.checkbox_status=s,this.message=o}}document.addEventListener("DOMContentLoaded",()=>{new f});
